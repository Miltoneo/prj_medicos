{% extends 'layouts/base_cenario_cadastro.html' %}
{% block content %}
<h2>Configuração de Rateio Mensal</h2>
<div class="container" style="display: flex; gap: 32px; align-items: flex-start;">
    <!-- Coluna 1: Seleção de mês e lista de itens de despesa -->
    <div class="col" style="flex: 1;">
        <form method="get">
            <label for="mes_competencia"><b>Mês de Competência:</b></label><br>
            <input type="month" id="mes_competencia" name="mes_competencia" value="{{ request.GET.mes_competencia|default:default_mes }}">
            <br><br>
            <label><b>Itens de Despesa:</b></label>
            <div class="itens-lista" style="border: 1px solid #ccc; max-height: 320px; overflow-y: auto; padding: 8px; background: #fafafa;">
                {% for item in itens_despesa %}
                    <button type="submit" name="item_despesa" value="{{ item.id }}" class="{% if item.id == selected_item_id %}selected{% endif %}" style="display: block; width: 100%; margin-bottom: 4px; padding: 8px; background: {% if item.id == selected_item_id %}#d0eaff{% else %}#f0f0f0{% endif %}; border: none; cursor: pointer; text-align: left; font-weight: {% if item.id == selected_item_id %}bold{% else %}normal{% endif %};">
                        {{ item.nome }}
                    </button>
                {% empty %}
                    <span class="text-muted">Nenhum item cadastrado.</span>
                {% endfor %}
            </div>
        </form>
    </div>
    <!-- Coluna 2: Tabela de sócios e percentuais -->
    <div class="col2" style="flex: 2;">
        <label><b>Rateio por Sócio</b></label>
        <form method="post">
            {% csrf_token %}
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 8px;">
                <thead>
                    <tr>
                        <th style="border: 1px solid #bbb; padding: 8px; background: #f5f5f5;">Sócio</th>
                        <th style="border: 1px solid #bbb; padding: 8px; background: #f5f5f5;">Percentual (%)</th>
                        <th style="border: 1px solid #bbb; padding: 8px; background: #f5f5f5;">Observações</th>
                        <th style="border: 1px solid #bbb; padding: 8px; background: #f5f5f5;">Ações</th>
                    </tr>
                </thead>
                <tbody>
                    {% for rateio in rateios %}
                    <tr>
                        <td style="border: 1px solid #bbb; padding: 8px;">{{ rateio.socio.nome }}</td>
                        <td style="border: 1px solid #bbb; padding: 8px;"><input type="number" name="percentual_{{ rateio.id }}" value="{{ rateio.percentual }}" min="0" max="100" step="0.01"></td>
                        <td style="border: 1px solid #bbb; padding: 8px;">{{ rateio.observacoes }}</td>
                        <td class="actions" style="border: 1px solid #bbb; padding: 8px;"><button name="edit" value="{{ rateio.id }}">Editar</button><button name="delete" value="{{ rateio.id }}">Remover</button></td>
                    </tr>
                    {% empty %}
                    <tr><td colspan="4" class="text-muted">Nenhum sócio cadastrado para este item.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
            <button name="add_socio" value="1">+ Adicionar Sócio</button>
            <div class="total" style="font-weight: bold; margin-top: 8px;">Total Percentual: {{ total_percentual|default:"0,00" }}%</div>
            <div class="controls" style="margin-top: 12px;">
                <button type="submit" class="btn btn-success">Salvar</button>
                <a href="{% url 'medicos:cadastro_rateio' %}" class="btn btn-secondary ms-2">Cancelar</a>
            </div>
        </form>
    </div>
</div>
{% endblock %}
