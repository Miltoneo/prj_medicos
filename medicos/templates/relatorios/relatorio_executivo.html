{% extends 'layouts/base_cenario_demonstrativo.html' %}
{% load humanize %}

{% block content %}
<style>
    .valor-monetario {
        font-family: 'Courier New', monospace;
        font-weight: 500;
        text-align: right;
    }
    .total-row {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
        color: white !important;
        font-weight: bold;
        border-top: 2px solid #4e73df;
    }
    .card-header-gradient {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .table-striped tbody tr:nth-of-type(odd) {
        background-color: rgba(0,0,0,.02);
    }
    .card-estatistica {
        transition: transform 0.2s;
    }
    .card-estatistica:hover {
        transform: translateY(-2px);
    }
    .filtro-competencia {
        background: linear-gradient(135deg, #28a745 0%, #20c997 100%);
    }
    .col-financeira-destaque {
        background: linear-gradient(135deg, #6f42c1 0%, #495057 100%) !important;
        color: white !important;
    }
</style>

<!-- Card Resumo Demonstrativo por Sócio -->
<div class="card shadow border-0 mb-4">
    <div class="card-header filtro-competencia text-white">
        <div class="d-flex align-items-center justify-content-between">
            <div class="d-flex align-items-center">
                <span class="fas fa-users me-3 fs-4"></span>
                <div>
                    <h4 class="mb-0 fw-bold">Resumo Demonstrativo por Sócio</h4>
                    <small class="opacity-75">Competência: {{ mes_ano_display }} | {{ empresa.name }}</small>
                </div>
            </div>
            <div>
                <form method="GET" class="d-flex align-items-center">
                    <label class="text-white me-2 small fw-bold">Competência:</label>
                    <input type="month" name="mes_ano" value="{{ mes_ano_selecionado }}" 
                           class="form-control form-control-sm" style="width: 150px;"
                           onchange="this.form.submit()">
                </form>
            </div>
        </div>
    </div>
    
    <div class="card-body p-4">
        <div class="table-responsive">
            <table class="table table-striped table-hover mb-0">
                <thead>
                    <tr class="table-success">
                        <th style="width: 12%;">Sócio</th>
                        <th style="width: 7.5%;" class="text-center">Receita bruta emitida</th>
                        <th style="width: 7.5%;" class="text-center">Receita bruta recebida</th>
                        <th style="width: 7.5%;" class="text-center">Imposto Devido</th>
                        <th style="width: 7.5%;" class="text-center">Imposto Retido</th>
                        <th style="width: 7.5%;" class="text-center">Imposto a Pagar</th>
                        <th style="width: 7.5%;" class="text-center">Receita líquida apurada</th>
                        <th style="width: 7.5%;" class="text-center col-financeira-destaque">Saldo financeiro</th>
                        <th style="width: 7.5%;" class="text-center col-financeira-destaque">Despesa com rateio</th>
                        <th style="width: 7.5%;" class="text-center col-financeira-destaque">Despesa sem rateio</th>
                        <th style="width: 7.5%;" class="text-center col-financeira-destaque">Imposto Provisionado Mês Anterior</th>
                        <th style="width: 8.5%;" class="text-center col-financeira-destaque">Saldo transferir</th>
                    </tr>
                </thead>
                <tbody>
                    {% for item in resumo_socios %}
                    <tr>
                        <td class="fw-semibold">
                            <i class="fas fa-user-md me-2 text-primary"></i>
                            {{ item.socio.pessoa.name }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.receita_emitida|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.receita_bruta|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.imposto_devido|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.imposto_retido|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.imposto_a_pagar|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.receita_liquida|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.saldo_financeiro|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.despesa_com_rateio|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.despesa_sem_rateio|floatformat:2 }}
                        </td>
                        <td class="valor-monetario text-dark">
                            R$ {{ item.imposto_provisionado_mes_anterior|floatformat:2 }}
                        </td>
                        <td class="valor-monetario fw-bold text-dark">
                            R$ {{ item.saldo_transferir|floatformat:2 }}
                        </td>
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="12" class="text-center text-muted py-4">
                            <i class="fas fa-info-circle me-2"></i>
                            Nenhum sócio encontrado para a competência selecionada.
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
                {% if resumo_socios %}
                <tfoot>
                    <tr class="table-dark fw-bold">
                        <td>TOTAL GERAL</td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.receita_emitida|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.receita_bruta|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.imposto_devido|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.imposto_retido|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.imposto_a_pagar|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.receita_liquida|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.saldo_financeiro|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.despesa_com_rateio|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.despesa_sem_rateio|floatformat:2 }}
                        </td>
                        <td class="valor-monetario">
                            R$ {{ totais_resumo.imposto_provisionado_mes_anterior|floatformat:2 }}
                        </td>
                        <td class="valor-monetario fw-bold text-success">
                            R$ {{ totais_resumo.saldo_transferir|floatformat:2 }}
                        </td>
                    </tr>
                </tfoot>
                {% endif %}
            </table>
        </div>
        
        <!-- Observações do Resumo -->
        <div class="mt-4 p-3 bg-light rounded">
            <h6 class="fw-bold mb-2">
                <i class="fas fa-info-circle me-2 text-success"></i>
                Sobre o Resumo Demonstrativo:
            </h6>
            <ul class="mb-0 small text-muted">
                <li><strong>Receita bruta emitida:</strong> Receita bruta emitida</li>
                <li><strong>Receita bruta recebida:</strong> Receita bruta recebida</li>
                <li><strong>Imposto Devido:</strong> por data de emissão da nota (regime competência) / por data de recebimento (regime caixa)</li>
                <li><strong>Imposto Retido:</strong> por data de recebimento da nota</li>
                <li><strong>Imposto a Pagar:</strong> Diferença entre imposto devido e retido</li>
                <li><strong>Receita líquida apurada:</strong> Receita bruta recebida menos impostos a pagar</li>
                <li><strong>Saldo financeiro:</strong> Saldo consolidado dos lançamentos financeiros do sócio</li>
                <li><strong>Despesa com rateio:</strong> Despesas rateadas proporcionalmente ao sócio</li>
                <li><strong>Despesa sem rateio:</strong> Despesas diretas e exclusivas do sócio</li>
                <li><strong>Imposto Provisionado Mês Anterior:</strong> Valor dos impostos a provisionar calculados no mês anterior</li>
                <li><strong>Saldo transferir:</strong> Valor disponível para transferência (Saldo financeiro - Despesa com rateio - Despesa sem rateio - Imposto Provisionado Mês Anterior)</li>
            </ul>
        </div>
    </div>
</div>

<!-- Footer -->
<div class="text-center mt-5 mb-4">
    <div class="card border-0 bg-light">
        <div class="card-body p-3">
            <small class="text-muted">
                <i class="fas fa-clock me-1"></i>
                Relatório gerado em {% now "d/m/Y \à\s H:i" %} | 
                <i class="fas fa-building me-1"></i>
                Sistema de Gestão Médica
            </small>
        </div>
    </div>
</div>
{% endblock %}
