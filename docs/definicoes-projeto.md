# üéØ Diretivas do Projeto - Sistema de Gest√£o Financeira M√©dica

**Data de Cria√ß√£o**: 07/07/2025  
**Framework**: Django 4.x  
**Arquitetura**: SaaS Multi-Tenant

---

## üìú **DIRETIVAS FUNDAMENTAIS**

### **üîí 1. C√ìDIGO COMO FONTE DA VERDADE**
- O c√≥digo hardcoded √© SEMPRE a refer√™ncia absoluta para documenta√ß√£o
- Nunca gerar documenta√ß√£o baseada em vers√µes anteriores ou mem√≥ria
- Toda documenta√ß√£o deve ser regenerada a partir do c√≥digo atual
- Eliminar aliases legacy e padronizar nomenclaturas conforme c√≥digo real
- Validar sempre que documenta√ß√£o reflete exatamente o estado do c√≥digo

### **üèóÔ∏è 2. ARQUITETURA E MODULARIZA√á√ÉO**
- Manter separa√ß√£o clara entre m√≥dulos: `base.py`, `fiscal.py`, `financeiro.py`, `despesas.py`, `auditoria.py`, `relatorios.py`
- Respeitar isolamento multi-tenant atrav√©s do modelo `Conta`
- Preservar hierarquia de relacionamentos e constraints definidas no c√≥digo
- N√£o criar depend√™ncias circulares entre m√≥dulos
- Manter modelos simples, focados e com responsabilidade √∫nica

### **üîß 3. NOMENCLATURA E PADR√ïES**
- **Modelos**: PascalCase exato conforme definido no c√≥digo
- **Campos**: snake_case conforme implementa√ß√£o atual
- **Constantes**: UPPER_SNAKE_CASE conforme padr√µes Django
- Eliminar aliases de compatibilidade quando n√£o utilizados
- Manter consist√™ncia de nomes em todo o projeto
- Atualizar refer√™ncias em `admin.py`, `forms.py`, `views.py`, `tables.py` quando necess√°rio

### **üìä 4. MODELAGEM DE DADOS**
- Respeitar constraints de unique_together definidas no c√≥digo
- Manter valida√ß√µes em m√©todos `clean()` conforme implementado
- Preservar √≠ndices de performance existentes
- N√£o alterar relacionamentos sem an√°lise completa de impacto
- Documentar decis√µes de design baseadas no c√≥digo atual

### **üîç 5. AN√ÅLISE DE MODELAGEM COMPLETA**
- Toda an√°lise de modelagem solicitada deve considerar TODOS os modelos definidos em hardcode Django
- Incluir obrigatoriamente modelos de todos os arquivos: `base.py`, `fiscal.py`, `financeiro.py`, `despesas.py`, `auditoria.py`, `relatorios.py`
- Analisar relacionamentos entre todos os modelos, n√£o apenas subconjuntos
- Validar constraints e dependencies em toda a base de modelos
- Nunca fazer an√°lise parcial ignorando modelos existentes no c√≥digo

### **üõ°Ô∏è 6. VALIDA√á√ïES E COMPLIANCE**
- Manter valida√ß√µes tribut√°rias conforme legisla√ß√£o brasileira
- Preservar regras de neg√≥cio implementadas nos modelos
- Respeitar constraints de integridade de dados
- Manter logs de auditoria em todas as opera√ß√µes cr√≠ticas
- Validar percentuais de rateio (soma = 100%)

### **üìù 7. DOCUMENTA√á√ÉO E ORGANIZA√á√ÉO**
- Manter documenta√ß√£o centralizada em `docs/` com subpastas tem√°ticas
- Remover arquivos `.md` n√£o solicitados da pasta principal
- Gerar diagramas ER apenas quando solicitado explicitamente
- Manter arquivo de diretivas sempre atualizado
- Documentar apenas o que est√° implementado no c√≥digo
- Scripts de teste devem ficar exclusivamente na pasta de scripts (ex: `test_scripts/`)

### **üìÅ 7.1. CENTRALIZA√á√ÉO E N√ÉO DUPLICIDADE DE DOCUMENTA√á√ÉO**
- N√£o criar novo arquivo de documenta√ß√£o se j√° existir arquivo que trate do mesmo assunto.
- Utilize e atualize sempre o arquivo existente para manter a rastreabilidade e evitar duplicidade de informa√ß√µes.
- Antes de documentar, verifique a exist√™ncia de arquivos relacionados no diret√≥rio `docs/` e subpastas.

### **üîÑ 8. DESENVOLVIMENTO E MANUTEN√á√ÉO**
- Testar todas as altera√ß√µes em ambiente de desenvolvimento
- Manter compatibilidade com Django 4.x
- Preservar funcionalidades existentes ao fazer refatora√ß√µes
- Documentar breaking changes quando necess√°rio
- Manter requirements.txt atualizado

### **‚ö° 9. PERFORMANCE E OTIMIZA√á√ÉO**
- Usar select_related para consultas com relacionamentos
- Manter √≠ndices compostos para filtros frequentes
- Otimizar queries com base em padr√µes de uso reais
- Implementar pagina√ß√£o em listagens grandes
- Monitorar performance de consultas complexas

### **üîê 10. SEGURAN√áA E AUDITORIA**
- Manter isolamento de dados por tenant (Conta)
- Registrar todas as opera√ß√µes em LogAuditoriaFinanceiro
- Validar permiss√µes conforme ContaMembership roles
- Preservar rastreamento de IP e user-agent
- Implementar controles de acesso granulares

### **üé® 11. INTERFACE E USABILIDADE**
- Manter consist√™ncia visual conforme templates existentes
- Preservar funcionalidades de filtros e busca
- Implementar valida√ß√µes client-side quando apropriado
- Manter responsividade para dispositivos m√≥veis
- Priorizar usabilidade sobre complexidade t√©cnica

### **üé® 11.2. PADRONIZA√á√ÉO DE ESTILOS DE P√ÅGINA**
- O projeto deve possuir uma padroniza√ß√£o de estilos de p√°gina, garantindo identidade visual consistente em todas as telas.
- Os templates devem herdar de um template base comum e utilizar CSS global compartilhado.
- Mudan√ßas de layout e estilo devem ser aplicadas de forma centralizada, facilitando manuten√ß√£o e evolu√ß√£o visual.
- A padroniza√ß√£o deve priorizar clareza, legibilidade e responsividade.

### **üß≠ 11.1. SISTEMA DE NAVEGA√á√ÉO E USABILIDADE**
- O sistema deve possuir um menu de navega√ß√£o global, acess√≠vel em todas as p√°ginas principais.
- O menu deve garantir acesso f√°cil e intuitivo a todas as funcionalidades essenciais do sistema (Dashboard, Usu√°rios, Admin, Login/Logout, etc).
- A navega√ß√£o deve ser responsiva e clara, priorizando a experi√™ncia do usu√°rio.
- O menu deve destacar a p√°gina ativa e exibir informa√ß√µes do usu√°rio autenticado quando aplic√°vel.
- Melhorias de usabilidade e acessibilidade devem ser priorizadas em toda evolu√ß√£o do menu.

### **üß≠ 11.3. MELHORES PR√ÅTICAS PARA MENUS DE NAVEGA√á√ÉO**
- O sistema deve adotar menus de navega√ß√£o claros, intuitivos e consistentes em todas as p√°ginas.
- Menus de topo (navbar) s√£o recomendados para sistemas com poucas se√ß√µes principais e navega√ß√£o simples.
- Menus laterais (sidebar) s√£o indicados para sistemas com m√∫ltiplas √°reas, m√≥dulos ou funcionalidades agrupadas.
- O menu ativo deve ser destacado visualmente para orientar o usu√°rio.
- Menus devem ser responsivos: colapsar ou adaptar em telas menores.
- √çcones e agrupamento de itens podem ser usados para facilitar a identifica√ß√£o de funcionalidades.
- Sempre priorizar acessibilidade: contraste, navega√ß√£o por teclado e leitores de tela.
- Evitar menus excessivamente profundos ou complexos; priorizar clareza e rapidez de acesso.
- A escolha entre menu lateral ou topo deve considerar o perfil do usu√°rio, quantidade de funcionalidades e contexto de uso.

### **üß≠ 11.4. MELHORES PR√ÅTICAS DE FUNCIONALIDADE PARA MENU SUPERIOR (NAVBAR)**
- O menu superior deve conter links para as principais √°reas do sistema (Dashboard, Usu√°rios, Admin, etc.), sempre vis√≠veis.
- Exibir claramente o usu√°rio autenticado e op√ß√£o de login/logout.
- Destacar visualmente a p√°gina/rota ativa.
- O menu deve ser responsivo: colapsar em um bot√£o (hamb√∫rguer) em telas pequenas.
- Permitir f√°cil expans√£o para novos m√≥dulos sem poluir visualmente.
- Utilizar √≠cones para refor√ßar a identifica√ß√£o das se√ß√µes, quando apropriado.
- Garantir contraste e acessibilidade para navega√ß√£o por teclado e leitores de tela.
- Evitar menus suspensos excessivamente profundos; priorizar acesso r√°pido.
- O logo ou nome do sistema deve estar sempre vis√≠vel e servir de atalho para o dashboard.
- O menu deve ser fixo no topo para acesso constante durante a navega√ß√£o.

### **üß≠ 11.5. CARACTER√çSTICAS E FUNCIONALIDADES DE UM MENU SUPERIOR (NAVBAR)**
- Deve ser exibido no topo de todas as p√°ginas principais do sistema.
- Apresentar o logo ou nome do sistema √† esquerda, servindo de atalho para o dashboard.
- Exibir links para as principais √°reas: Dashboard, Usu√°rios, Admin, Relat√≥rios, etc.
- Destacar visualmente a p√°gina ativa para orientar o usu√°rio.
- Mostrar o nome/e-mail do usu√°rio autenticado e op√ß√£o de login/logout √† direita.
- Ser responsivo: transformar-se em menu hamb√∫rguer em telas pequenas.
- Permitir f√°cil expans√£o para novos m√≥dulos sem poluir o visual.
- Suportar √≠cones ao lado dos itens para facilitar identifica√ß√£o.
- Garantir contraste, acessibilidade e navega√ß√£o por teclado.
- Ser fixo no topo para acesso constante durante a navega√ß√£o.
- Opcionalmente, pode incluir notifica√ß√µes, atalhos r√°pidos ou menu de perfil do usu√°rio.

### **üß≠ 11.6. MELHORES PR√ÅTICAS PARA MENU DE NAVEGA√á√ÉO LATERAL (SIDEBAR)**
- Deve ser exibido √† esquerda da tela, dispon√≠vel em todas as p√°ginas principais.
- Agrupar funcionalidades por se√ß√µes ou m√≥dulos, facilitando a navega√ß√£o em sistemas com muitos recursos.
- Destacar visualmente o item ativo e o grupo expandido.
- Permitir colapso/expans√£o do menu para economizar espa√ßo, especialmente em telas menores.
- Utilizar √≠cones ao lado dos itens para r√°pida identifica√ß√£o.
- Garantir contraste, acessibilidade e navega√ß√£o por teclado.
- O menu deve ser responsivo: ocultar ou transformar-se em menu deslizante em dispositivos m√≥veis.
- Permitir f√°cil expans√£o para novos m√≥dulos sem comprometer a clareza.
- Pode incluir avatar, nome do usu√°rio e atalhos r√°pidos no topo ou rodap√© do menu.
- Evitar menus excessivamente profundos; priorizar acesso r√°pido √†s principais √°reas.
- Manter o menu fixo durante a navega√ß√£o para acesso constante.

### **üß≠ 11.7. PADR√ÉO DE NAVEGA√á√ÉO ENTRE MENUS SUPERIOR E LATERAL**
- A navega√ß√£o entre as funcionalidades espec√≠ficas do aplicativo "medicos" (ex: dashboard, relat√≥rios, m√≥dulos m√©dicos, consultas, etc.) deve ser realizada prioritariamente pelo menu lateral (sidebar).
- O menu lateral deve agrupar e organizar todas as funcionalidades do dom√≠nio m√©dico, facilitando o acesso r√°pido e contextual.
- O menu superior (navbar) ser√° reservado para funcionalidades de sistema: login, logout, admin, usu√°rios, perfil, notifica√ß√µes e demais a√ß√µes globais.
- O menu superior deve estar sempre vis√≠vel, enquanto o menu lateral pode ser colaps√°vel para melhor uso do espa√ßo.
- Essa separa√ß√£o garante clareza, escalabilidade e melhor experi√™ncia de navega√ß√£o para o usu√°rio.

### **üé® 11.8. USO DE FRAMEWORKS DE ESTILO (BOOTSTRAP)**
- O projeto deve utilizar frameworks de estilo modernos, como Bootstrap, para garantir responsividade, consist√™ncia visual e agilidade no desenvolvimento.
- O Bootstrap deve ser inclu√≠do via CDN ou arquivos locais no template base, antes dos estilos customizados.
- Aproveitar classes utilit√°rias e componentes do Bootstrap para layout, espa√ßamento, tipografia, bot√µes, alertas, navega√ß√£o, etc.
- Estruturar o layout com o grid do Bootstrap (`container`, `row`, `col`) para responsividade nativa.
- Personaliza√ß√µes devem ser feitas preferencialmente via vari√°veis ou classes pr√≥prias, evitando sobrescrever regras do framework.
- Consultar sempre a documenta√ß√£o oficial do Bootstrap para melhores pr√°ticas e exemplos.
- Remover estilos n√£o utilizados e revisar periodicamente para manter a consist√™ncia visual.

### **üìà 12. EVOLU√á√ÉO E FUTURO**
- Preparar APIs para futuras integra√ß√µes
- Manter c√≥digo flex√≠vel para novas funcionalidades
- Documentar limita√ß√µes conhecidas
- Planejar evolutivas baseadas em necessidades reais
- Manter c√≥digo leg√≠vel e bem documentado

### **üö® 13. CRIT√âRIOS DE QUALIDADE**
- Zero breaking changes sem aviso pr√©vio
- Todas as migra√ß√µes devem ser testadas
- C√≥digo deve passar em linting e formata√ß√£o
- Cobertura de testes para funcionalidades cr√≠ticas
- Documenta√ß√£o deve estar sempre sincronizada

### **üß© 4.1. ATUALIZA√á√ÉO DE HARDCODE**
- Sempre que houver altera√ß√£o em modelos, campos ou relacionamentos, atualizar imediatamente o diagrama ER hardcoded e os arquivos de defini√ß√£o de modelos.
- O diagrama ER e as defini√ß√µes hardcoded devem refletir fielmente o c√≥digo-fonte vigente dos modelos Django.
- Toda documenta√ß√£o de modelagem deve ser gerada ou revisada a partir do c√≥digo real, nunca de vers√µes antigas ou mem√≥ria.
- Mudan√ßas em nomes de campos, remo√ß√£o de redund√¢ncias ou ajustes de nomenclatura devem ser refletidos nos arquivos de documenta√ß√£o e diagramas imediatamente.
- A sincroniza√ß√£o entre c√≥digo e documenta√ß√£o √© obrigat√≥ria e cont√≠nua.

---

### **‚úÖ Checklist para ER e Modelagem de Dados Confi√°vel (Revisado)**

- [ ] Todos os arquivos em `medicos/models/` foram lidos e analisados?
- [ ] Para cada modelo, o c√≥digo-fonte est√° aberto lado a lado com o ER durante a revis√£o?
- [ ] Todos os modelos definidos no c√≥digo est√£o presentes no ER?
- [ ] **Cada campo de cada modelo foi conferido linha a linha entre o c√≥digo e o ER?**
- [ ] Todos os tipos de campo (incluindo FKs, M2M, O2O, Decimal, Boolean, Date, etc.) est√£o corretos no ER?
- [ ] Todos os relacionamentos (FK, M2M, O2O) est√£o representados?
- [ ] Todas as constraints (`unique_together`, `indexes`, etc.) est√£o documentadas?
- [ ] O ER/documenta√ß√£o foi atualizado imediatamente ap√≥s a √∫ltima altera√ß√£o no c√≥digo?
- [ ] O ER/documenta√ß√£o n√£o cont√©m modelos/campos/relacionamentos que n√£o existem mais no c√≥digo?
- [ ] Nomenclatura dos modelos e campos est√° id√™ntica √† do c√≥digo (sem aliases)?
- [ ] O ER/documenta√ß√£o foi validado por outro desenvolvedor ou por revis√£o cruzada?
- [ ] Toda altera√ß√£o em modelos foi refletida nos arquivos de documenta√ß√£o e diagramas?
- [ ] (Recomendado) Utilizou script ou ferramenta para extra√ß√£o autom√°tica dos campos dos modelos?

> **Este checklist deve ser seguido e marcado a cada altera√ß√£o de modelagem para garantir total confiabilidade e ader√™ncia ao c√≥digo-fonte. Confer√™ncia linha a linha √© obrigat√≥ria para cada campo de cada modelo.**

---

## ‚ö†Ô∏è **PROIBI√á√ïES ABSOLUTAS**

- ‚ùå **NUNCA** gerar documenta√ß√£o baseada em vers√µes antigas
- ‚ùå **NUNCA** criar aliases sem verificar uso no c√≥digo
- ‚ùå **NUNCA** alterar modelos sem an√°lise completa de impacto
- ‚ùå **NUNCA** quebrar isolamento multi-tenant
- ‚ùå **NUNCA** remover valida√ß√µes de compliance fiscal
- ‚ùå **NUNCA** criar documenta√ß√£o n√£o solicitada na pasta principal
- ‚ùå **NUNCA** assumir estruturas sem validar no c√≥digo
- ‚ùå **NUNCA** implementar sem testar em ambiente de desenvolvimento

---

## ‚úÖ **OBRIGA√á√ïES SEMPRE**

- ‚úÖ **SEMPRE** ler o c√≥digo antes de documentar
- ‚úÖ **SEMPRE** validar nomenclaturas no c√≥digo hardcoded
- ‚úÖ **SEMPRE** atualizar refer√™ncias em arquivos dependentes
- ‚úÖ **SEMPRE** manter sincroniza√ß√£o entre c√≥digo e documenta√ß√£o
- ‚úÖ **SEMPRE** preservar funcionalidades existentes
- ‚úÖ **SEMPRE** documentar decis√µes t√©cnicas importantes
- ‚úÖ **SEMPRE** manter logs de auditoria atualizados
- ‚úÖ **SEMPRE** validar multi-tenancy em altera√ß√µes

---

## üéØ **OBJETIVO FINAL**

Manter um sistema Django robusto, bem documentado e perfeitamente sincronizado entre c√≥digo e documenta√ß√£o, com foco em:
- **Confiabilidade** dos dados financeiros
- **Compliance** fiscal brasileiro
- **Escalabilidade** multi-tenant
- **Manutenibilidade** do c√≥digo
- **Usabilidade** para m√©dicos e contadores

---

*Estas diretivas s√£o mandat√≥rias para qualquer altera√ß√£o no projeto e devem ser consultadas antes de qualquer modifica√ß√£o no c√≥digo ou documenta√ß√£o.*
